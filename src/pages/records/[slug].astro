---
import Layout from '../../layouts/Layout.astro';

// Static paths for build
export function getStaticPaths() {
  const records = [
    {
      slug: 'miles-davis-kind-of-blue',
      title: 'Kind of Blue',
      artist: 'Miles Davis',
      price: 35,
      image: '/records/kind-of-blue.svg',
      condition: 'VG+',
      genre: 'Jazz',
      year: '1959',
      label: 'Columbia',
      description: 'The bestselling jazz album of all time. This pressing is a later Columbia reissue in excellent shape. Sleeve shows minor ring wear, vinyl plays beautifully with only light surface noise in quiet passages.'
    },
    {
      slug: 'fleetwood-mac-rumours',
      title: 'Rumours',
      artist: 'Fleetwood Mac',
      price: 28,
      image: '/records/rumours.svg',
      condition: 'VG+',
      genre: 'Rock',
      year: '1977',
      label: 'Warner Bros.',
      description: 'Original pressing with textured sleeve. One of the defining albums of the 70s. Vinyl is clean with minimal wear, plays through with no skips. Inner sleeve included.'
    },
    {
      slug: 'talking-heads-remain-in-light',
      title: 'Remain in Light',
      artist: 'Talking Heads',
      price: 32,
      image: '/records/remain-in-light.svg',
      condition: 'NM',
      genre: 'Rock',
      year: '1980',
      label: 'Sire',
      description: 'Near mint copy of this art-rock masterpiece. Sleeve is sharp with intact corners. Vinyl looks unplayed. Includes original inner sleeve and insert.'
    },
    {
      slug: 'stevie-wonder-innervisions',
      title: 'Innervisions',
      artist: 'Stevie Wonder',
      price: 25,
      image: '/records/innervisions.svg',
      condition: 'VG',
      genre: 'Soul',
      year: '1973',
      label: 'Tamla',
      description: 'Original Tamla pressing with gatefold sleeve. Some surface marks visible but plays well throughout. A stone-cold classic at a fair price.'
    },
    {
      slug: 'john-coltrane-a-love-supreme',
      title: 'A Love Supreme',
      artist: 'John Coltrane',
      price: 45,
      image: '/records/a-love-supreme.svg',
      condition: 'VG+',
      genre: 'Jazz',
      year: '1965',
      label: 'Impulse!',
      description: 'Later Impulse! pressing of Coltrane\'s spiritual jazz landmark. Gatefold sleeve in great shape. Vinyl plays quietly with deep bass response.'
    },
    {
      slug: 'joni-mitchell-blue',
      title: 'Blue',
      artist: 'Joni Mitchell',
      price: 30,
      image: '/records/blue.svg',
      condition: 'VG+',
      genre: 'Folk',
      year: '1971',
      label: 'Reprise',
      description: 'Early Reprise pressing. One of the greatest singer-songwriter albums ever made. Sleeve has light wear, vinyl is excellent with full dynamics intact.'
    }
  ];

  return records.map(record => ({
    params: { slug: record.slug },
    props: { record }
  }));
}

const { record } = Astro.props;
const { title, artist, price, image, condition, genre, year, label, description, slug } = record;

// For Snipcart
const productUrl = `${Astro.site}records/${slug}`;
---

<Layout title={`${artist} - ${title}`} description={description}>
  <article class="product-page">
    <div class="container">
      <a href="/shop" class="back-link text-sm">&larr; Back to Shop</a>

      <div class="product-layout mt-lg">
        <div class="product-image">
          <img src={image} alt={`${artist} - ${title}`} />
        </div>

        <div class="product-info">
          <p class="genre text-xs text-gray">{genre}</p>
          <h1>{title}</h1>
          <p class="artist">{artist}</p>

          <div class="meta mt-lg">
            <div class="meta-item">
              <span class="text-xs text-gray">Year</span>
              <span>{year}</span>
            </div>
            <div class="meta-item">
              <span class="text-xs text-gray">Label</span>
              <span>{label}</span>
            </div>
            <div class="meta-item">
              <span class="text-xs text-gray">Condition</span>
              <span>{condition}</span>
            </div>
          </div>

          <p class="description mt-lg">{description}</p>

          <div class="purchase mt-xl">
            <p class="price">${price}</p>
            <button
              class="btn snipcart-add-item"
              data-item-id={slug}
              data-item-name={`${artist} - ${title}`}
              data-item-price={price}
              data-item-url={productUrl}
              data-item-image={image}
              data-item-description={`${condition} condition, ${year} ${label} pressing`}
            >
              Add to Cart
            </button>
          </div>

          <div class="shipping-note mt-lg">
            <p class="text-sm text-gray">
              Ships via USPS Media Mail. Records are carefully packaged
              in cardboard mailers with additional protection.
            </p>
          </div>
        </div>
      </div>
    </div>
  </article>
</Layout>

<style>
  .back-link {
    display: inline-block;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding-top: var(--space-lg);
  }

  .product-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
    align-items: start;
  }

  @media (max-width: 768px) {
    .product-layout {
      grid-template-columns: 1fr;
    }
  }

  .product-image img {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    background: var(--color-gray-light);
  }

  .product-info h1 {
    font-size: clamp(1.75rem, 3vw, 2.5rem);
    margin-top: var(--space-xs);
  }

  .artist {
    font-size: 1.125rem;
    color: var(--color-gray);
  }

  .meta {
    display: flex;
    gap: var(--space-xl);
  }

  .meta-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .description {
    color: var(--color-gray);
    line-height: 1.7;
  }

  .purchase {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    padding-top: var(--space-lg);
    border-top: 1px solid var(--color-gray-light);
  }

  .price {
    font-family: var(--font-serif);
    font-size: 1.75rem;
  }

  .shipping-note {
    padding: var(--space-md);
    background: var(--color-gray-light);
  }
</style>
